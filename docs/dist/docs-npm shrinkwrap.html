<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
  <meta name="format-detection" content="telephone=no,email=no" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge, chrome=1">
  <meta name="description" content="description of your site">
  <meta name="author" content="author of the site">
  <title>YKit 使用手册</title>
  <link rel="stylesheet" href="source/main.css"/>
  
</head>
<body>
    <div class="ydoc">
      <header class="ydoc-header">
        <div class="ydoc-header-area">
            
            <a href="http://ued.qunar.com/ymfe/" class="navbar-brand">YMFE</a>
            
            <button class="ydocIcon navbar-toggle">&#xf020;</button>
            <nav class="ydoc-nav">
              <ul class="navbar-left">
                
                    
                    <li class="">
                        
                        <a href="index.html">简介</a>
                        
                    </li>
                    
                    <li class="">
                        
                        <a href="migrate.html">项目迁移</a>
                        
                    </li>
                    
                    <li class="active">
                        
                        <a href="docs.html">使用手册</a>
                        
                    </li>
                    
                    <li class="">
                        
                        <a href="releases.html">版本记录</a>
                        
                    </li>
                    
                
              </ul>
            </nav>
        </div>
    </header>
    
    <!-- <header style="height:20px"></header> -->
    
      <!-- Docs page layout -->
      
      <div class="ydoc-banner-bg">
          <div class="ydoc-banner">
              <div class="ydoc-banner-area">
                  <h1>Ykit</h1>
                  <p>User Manual</p>
              </div>
          </div>
      

      <div class="ydoc-container">
        
          
          <div class="ydoc-container-content">
              <div class="content-left" role="complementary">
                  <nav class="docs-sidebar hidden-print hidden-xs hidden-sm">
                    <ul class="nav docs-sidenav">
                        
                        
                        <!-- <li  > -->
                        <li >
                            
                            <a href="docs-配置.html">配置</a>
                            
                        </li>
                        
                        
                        
                        <!-- <li  > -->
                        <li >
                            
                            <a href="docs-命令行.html">命令行</a>
                            
                        </li>
                        
                        
                        
                        <!-- <li  > -->
                        <li >
                            
                            <a href="docs-插件.html">插件</a>
                            
                        </li>
                        
                        
                        
                        <!-- <li  > -->
                        <li >
                            
                            <a href="docs-代理工具.html">代理工具</a>
                            
                        </li>
                        
                        
                        
                        <!-- <li  > -->
                        <li >
                            
                            <a href="docs-Node.js API.html">Node.js API</a>
                            
                        </li>
                        
                        
                        
                        <!-- <li  > -->
                        <li >
                            
                            <a href="docs-打包 JOB.html">打包 JOB</a>
                            
                        </li>
                        
                        
                        
                        <!-- <li  > -->
                        <li >
                            
                            <a href="docs-前后端版本号关联.html">前后端版本号关联</a>
                            
                        </li>
                        
                        
                        
                        <!-- <li  class="active"   class="active" > -->
                        <li  class="active" >
                            
                            <a href="docs-npm shrinkwrap.html">npm shrinkwrap</a>
                            
                        </li>
                        
                        
                    </ul>
                  </nav>
              </div>
              <div class="content-right markdown-body" role="main">

                
                <h1 style="font-weight: normal"> npm shrinkwrap </h1>

<h2 style="font-weight: normal"> 什么是 npm shrinkwrap？ </h2>

<p>npm shrinkwrap 是 npm 包管理器的一项功能。可以按照当前项目 node_modules 目录内的安装包情况生成稳定的版本号描述。shrinkwrap 文件的结构类似以下这种形式：</p>
<pre><code class="lang-json">{
  &quot;name&quot;: &quot;A&quot;,
  &quot;version&quot;: &quot;1.1.0&quot;,
  &quot;dependencies&quot;: {
    &quot;B&quot;: {
      &quot;version&quot;: &quot;1.0.1&quot;,
      &quot;from&quot;: &quot;B@^1.0.0&quot;,
      &quot;resolved&quot;: &quot;https://registry.npmjs.org/B/-/B-1.0.1.tgz&quot;,
      &quot;dependencies&quot;: {
        &quot;C&quot;: {
          &quot;version&quot;: &quot;1.0.1&quot;,
          &quot;from&quot;: &quot;org/C#v1.0.1&quot;,
          &quot;resolved&quot;: &quot;git://github.com/org/C.git#v1.0.1&quot;
        }
      }
    }
  }
}
</code></pre>
<h2 style="font-weight: normal"> 为什么需要它？ </h2>

<p>在没有 shrinkwrap 的项目中，任意一个依赖包都可能在开发者不知情的情况下发生改动，进而引发线上故障。</p>
<p>在一个 JavaScript 项目中，每次执行 <code>npm install</code>，最后生成的结果可能是不一样的。譬如说现在某个项目依赖了模块 A, 虽然我们可以为它指定一个固定的版本号，然而 A 所依赖的其它模块版本使用的是 npm semver 规则（semantic version，npm 模块依赖默认遵循的规则）。它并不严格规定版本，而是选择符合当前 semver 规则的最新版本进行安装。</p>
<p>一个简单的例子：假如模块 A 中依赖了 B，并且在 A 的 package.json 中指定 B 的 semver 为 ~1.2.3，那么所有形式为 1.2.x 的版本都是符合规则的。当模块 B 更新了一个 1.2.x 的小版本后，项目在下次构建中就会获取到它。</p>
<p>semver 这样设计的初衷是使模块的开发者可以将 bugfix 等微小的改动能更便捷地到达使用方。但它的负面影响却是使每次 npm install 构建过程之间，项目内的模块内容随时可能发生改变。我们没法确定在每个模块内部，每一次小版本更新时究竟是加入了 bugfix，还是改变了 API，亦或是注入了恶意代码。</p>
<p>为了保证线上构建的稳定性，我们决定强制在每个 Ykit 的项目中添加 shrinkwrap。</p>
<h2 style="font-weight: normal"> 业务需要做什么？ </h2>

<p>Ykit 会在一个项目 commit 之前检查并更新 <code>npm-shrinkwrap.json</code>（如果没有则会生成一个），业务需要做的只是将这个文件提交，保持它是最新的即可。当然也可以执行<code>npm shrinkwrap</code> 来进行手动更新。</p>
<h2 style="font-weight: normal"> 错误处理 </h2>

<p>生成 <code>npm-shrinkwrap.json</code> 过程的中报错，大多是因为 package.json 和 node_modules 中模块版本不一致（其实是不应该出现的），按照提示的错误改正即可。</p>
<p><img src="http://ww1.sinaimg.cn/large/6af705b8gw1fabnozkuojj20iw09g41u.jpg" alt="shrinkwrap 报错"></p>
<p>如果还有问题请 qtalk 联系 <code>yuhao.ju</code>。</p>

              </div>
              <div class="open-panel"></div>
          </div>
          
        
      </div>
     
     </div>
     
      <footer class="footer">
        <div class="copyright">
            &copy; 2016 <a href="http://ued.qunar.com/ymfe/">YMFE Team</a>. Build by <a href="http://github.com/YMFE/ydoc">ydoc</a>
        </div>
      </footer>
    </div>

    <script src="source/main.js"></script>
    <script src="source/app.js"></script>
    
    

    

    

</body>
</html>
