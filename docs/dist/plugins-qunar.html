<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
  <meta name="format-detection" content="telephone=no,email=no" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge, chrome=1">
  <meta name="description" content="description of your site">
  <meta name="author" content="author of the site">
  <title>YKit 插件</title>
  <link rel="stylesheet" href="source/main.css"/>
  
    
<link rel="stylesheet" href="./theme/ydoc.css"/>
    
  
</head>
<body class=plugins-@qnpm/ykit-conifg-qunar >
    <div class="ydoc">
      <header class="ydoc-header">
        <div class="ydoc-header-area">
            
            <a href="http://ued.qunar.com/ymfe/" class="navbar-brand">YMFE</a>
            
            <button class="ydocIcon navbar-toggle">&#xf020;</button>
            <nav class="ydoc-nav">
              <ul class="navbar-left">
                
                    
                    <li class="">
                        
                        <a href="index.html">简介</a>
                        
                    </li>
                    
                    <li class="">
                        
                        <a href="docs.html">使用手册</a>
                        
                    </li>
                    
                    <li class="active">
                        
                        <a href="plugins.html">插件</a>
                        
                    </li>
                    
                    <li class="">
                        
                        <a href="migrate.html">项目迁移</a>
                        
                    </li>
                    
                    <li class="">
                        
                        <a href="releases.html">版本记录</a>
                        
                    </li>
                    
                
              </ul>
            </nav>
        </div>
    </header>
    
    <!-- <header style="height:20px"></header> -->
    
      <!-- Docs page layout -->
      
      <div class="ydoc-banner-bg">
          <div class="ydoc-banner">
              <div class="ydoc-banner-area">
                  <h1>Ykit</h1>
                  <p>Plugins</p>
              </div>
          </div>
      

      <div class="ydoc-container">
        
          
          <div class="ydoc-container-content">
              <div class="content-left" role="complementary">
                  <nav class="docs-sidebar hidden-print hidden-xs hidden-sm">
                    <ul class="nav docs-sidenav">
                        
                        
                        <!-- <li  > -->
                        <li >
                            
                            <a href="plugins.html">简介</a>
                            
                        </li>
                        
                        
                        
                        <!-- <li   class="active" > -->
                        <li >
                            
                            <a href="javascript:void(0);">插件列表</a>
                            
                        </li>
                        
                        
                        
                        
                        <ul class="nav docs-sidenav-extend"  style="display:block;"    style="display:block;" >
                        
                            <li  class="active" >
                                <a href="plugins-qunar.html">@qnpm/ykit-conifg-qunar</a>
                            </li>
                        
                        
                        
                        
                        
                            <li >
                                <a href="plugins-fekit.html">@qnpm/ykit-conifg-fekit</a>
                            </li>
                        
                        
                        
                        
                        
                            <li >
                                <a href="plugins-yo.html">ykit-conifg-yo</a>
                            </li>
                        
                        </ul>
                        
                        
                        
                        
                        <!-- <li  > -->
                        <li >
                            
                            <a href="How-to-write-a-plugin.html">如何编写一个插件</a>
                            
                        </li>
                        
                        
                    </ul>
                  </nav>
              </div>
              <div class="content-right markdown-body" role="main">

                
                <h1 id="ykit-config-qunar">ykit-config-qunar</h1><h2 id="Features">Features</h2><ul>
<li>支持资源入口从 <code>src</code> 到 <code>dev &amp; prd</code> 的映射。</li>
<li>支持 <code>.scss/.sass./.less</code> 类型样式资源文件的编译处理，并将每个文件打包成同名 css。</li>
<li>支持 <code>ykit sync</code> 命令，同步代码至开发机。</li>
<li>支持资源分片（chunk) 异步加载。</li>
</ul>
<h2 id="安装">安装</h2><p>在项目中执行：</p>
<pre><code>$ npm install @qnpm/ykit-config-qunar --save --registry http://registry.npm.corp.qunar.com/
</code></pre><p>为了使该插件生效，需要将 ykit 配置文件的名称改为<code>ykit.qunar.js</code>。</p>
<h2 id="sync 命令">sync 命令</h2><p>sync 命令可将本地 <code>dev</code> 目录下代码上传至指定开发机，以便于联调测试。</p>
<h3 id="前置条件">前置条件</h3><p>执行 sync 命令之前要确保从本机可直连目标开发机，通过 ssh 命令可验证当前是否可直连，如：</p>
<pre><code>$ ssh yuhao.ju@192.168.237.71
</code></pre><p>如果没有提示需要密码，而直接登陆至目标开发机，则代表当前已经直连成功。配置直连的方法可以参考<a href="http://qtown.corp.qunar.com/knowledge/detail_knowledge.html?albumId=811">该课程</a>的最后一节。</p>
<h3 id="修改配置文件">修改配置文件</h3><p>在 ykit 配置文件中，指定 sync 参数，如：</p>
<pre><code class="lang-javascript">exports.config = function() {
    return {
        export: [
            //...
        ],
        modifyWebpackConfig: function(baseConfig) {
            // ...
        },
        sync: {
            // 配置 sync 机器的 ip 地址和项目存放路径
            host: &quot;192.168.237.71&quot;,
            path: &quot;/home/q/www/qunarzz.com/&lt;project_name&gt;&quot;
        }
    }
};
</code></pre>
<h3 id="执行 sync">执行 sync</h3><p>在项目中执行：</p>
<pre><code>$ ykit sync
</code></pre><p>第一次 sync 时会要求输入 qunar user id (如 yuhao.ju)，之后就不必再输了。</p>
<h2 id="shrinkwrap 命令">shrinkwrap 命令</h2><p>shrinkwrap 命令是对 npm shrinkwrap 进行的一层封装。</p>
<h3 id="什么是 npm shrinkwrap？">什么是 npm shrinkwrap？</h3><p>npm shrinkwrap 是 npm 包管理器的一项功能。可以按照当前项目 node_modules 目录内的安装包情况生成稳定的版本号描述。shrinkwrap 文件的结构类似以下这种形式：</p>
<pre><code class="lang-json">{
  &quot;name&quot;: &quot;A&quot;,
  &quot;version&quot;: &quot;1.1.0&quot;,
  &quot;dependencies&quot;: {
    &quot;B&quot;: {
      &quot;version&quot;: &quot;1.0.1&quot;,
      &quot;from&quot;: &quot;B@^1.0.0&quot;,
      &quot;resolved&quot;: &quot;https://registry.npmjs.org/B/-/B-1.0.1.tgz&quot;,
      &quot;dependencies&quot;: {
        &quot;C&quot;: {
          &quot;version&quot;: &quot;1.0.1&quot;,
          &quot;from&quot;: &quot;org/C#v1.0.1&quot;,
          &quot;resolved&quot;: &quot;git://github.com/org/C.git#v1.0.1&quot;
        }
      }
    }
  }
}
</code></pre>
<h3 id="为什么需要它？">为什么需要它？</h3><p>在没有 shrinkwrap 的项目中，任意一个依赖包都可能在开发者不知情的情况下发生改动，进而引发线上故障。</p>
<p>在一个 JavaScript 项目中，每次执行 <code>npm install</code>，最后生成的结果可能是不一样的。譬如说现在某个项目依赖了模块 A, 虽然我们可以为它指定一个固定的版本号，然而 A 所依赖的其它模块版本使用的是 npm semver 规则（semantic version，npm 模块依赖默认遵循的规则）。它并不严格规定版本，而是选择符合当前 semver 规则的最新版本进行安装。</p>
<p>一个简单的例子：假如模块 A 中依赖了 B，并且在 A 的 package.json 中指定 B 的 semver 为 ~1.2.3，那么所有形式为 1.2.x 的版本都是符合规则的。当模块 B 更新了一个 1.2.x 的小版本后，项目在下次构建中就会获取到它。</p>
<p>semver 这样设计的初衷是使模块的开发者可以将 bugfix 等微小的改动能更便捷地到达使用方。但它的负面影响却是使每次 npm install 构建过程之间，项目内的模块内容随时可能发生改变。我们没法确定在每个模块内部，每一次小版本更新时究竟是加入了 bugfix，还是改变了 API，亦或是注入了恶意代码。</p>
<p>为了保证线上构建的稳定性，建议为每个使用 npm 模块的项目添加 shrinkwrap。</p>
<h3 id="什么时候执行 shrinkwrap 命令？">什么时候执行 shrinkwrap 命令？</h3><p>当项目中不存在 <code>npm-shrinkwrap.json</code> 时，执行该命令。</p>
<pre><code>$ ykit shrinkwrap // 或使用命令简写 ykit sw
</code></pre><p>另外插件会在每次 git commit 之前检查 <code>npm-shrinkwrap.json</code>，如果提示需要更新则代表当前 <code>npm-shrinkwrap.json</code> 中记录的模块信息和当前 <code>node_modules</code> 中的不一致，需要再次执行 shrinkwrap 命令进行更新。</p>
<h3 id="错误处理">错误处理</h3><p>生成 <code>npm-shrinkwrap.json</code> 过程的中报错，大多是因为 package.json 和 node_modules 中模块版本不一致，按照提示的错误改正即可。</p>
<p><img src="http://ww1.sinaimg.cn/large/6af705b8gw1fabnozkuojj20iw09g41u.jpg" alt="shrinkwrap 报错"></p>
<h2 id="插件配置详情">插件配置详情</h2><pre><code class="lang-javascript">{
    context: &quot;./src&quot;,
    output: {
        local: {
            path: &#39;./prd/&#39;,
            filename: &#39;[name][ext]&#39;
            chunkFilename: &#39;[id].chunk.js&#39;,
            publicPath: &#39;//&#39; + path.join(&#39;q.qunarzz.com&#39;, projectDir, &#39;prd/&#39;)
        },
        dev: {
            path: &#39;dev&#39;,
            filename: &#39;[name]@dev[ext]&#39;,
            chunkFilename: &#39;[id].chunk@dev.js&#39;,
            publicPath: &#39;//&#39; + path.join(&#39;q.qunarzz.com&#39;, projectDir, &#39;dev/&#39;)
        },
        prd: {
            path: &#39;prd&#39;,
            filename: &#39;[name]@[chunkhash][ext]&#39;,
            chunkFilename: &#39;[id].chunk@[chunkhash].js&#39;,
            publicPath: &#39;//&#39; + path.join(&#39;q.qunarzz.com&#39;, projectDir, &#39;prd/&#39;)
        }
    },
    module: {
        loaders: this.config.module.loaders.concat([
            {
                test: /\.less$/,
                loader: ExtractTextPlugin.extract(
                    require.resolve(&#39;style-loader&#39;),
                    require.resolve(&#39;css-loader&#39;)
                        + &#39;?sourceMap!&#39;
                        + require.resolve(&#39;less-loader&#39;) + &#39;?sourceMap&#39;
                )
            },
            {
                test: /\.(sass|scss)$/,
                loader: ExtractTextPlugin.extract(
                    require.resolve(&#39;style-loader&#39;),
                    require.resolve(&#39;css-loader&#39;)
                        + &#39;?sourceMap!&#39;
                        + sysPath.join(__dirname, &#39;./loaders/sass.js&#39;) + &#39;?sourceMap&#39;
                )
            }
        ])
    },
    resolve: {
        extensions: this.config.resolve.extensions.concat([&#39;.less&#39;, &#39;.sass&#39;, &#39;.scss&#39;])
    }
}
</code></pre>

              </div>
              <div class="open-panel"></div>
          </div>
          
        
      </div>
     
     </div>
     
      <footer class="footer">
        <div class="copyright">
            &copy; 2016 <a href="http://ued.qunar.com/ymfe/">YMFE Team</a>. Build by <a href="http://github.com/YMFE/ydoc">ydoc</a>
        </div>
      </footer>
    </div>

    <script src="source/main.js"></script>
    <script src="source/app.js"></script>
    
    

    

    

</body>
</html>
